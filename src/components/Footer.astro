---
import { siteConfig } from "../config";

const EMAIL = siteConfig.social?.email ?? "your-email@example.com";
const SITE_NAME = siteConfig.name ?? "Portfolio";
const SUBJECT = `${SITE_NAME} • Inquiry`;
const BODY = `Hi ${siteConfig.name || "there"},%0D%0A%0D%0AI saw your portfolio and would like to talk about...`;
const MAILTO = `mailto:${EMAIL}?subject=${encodeURIComponent(SUBJECT)}&body=${encodeURIComponent(BODY)}`;

const hasProjects = siteConfig.projects && siteConfig.projects.length > 0;
const hasExperience = siteConfig.experience && siteConfig.experience.length > 0;
const hasEducation = siteConfig.education && siteConfig.education.length > 0;
const hasCertifications = siteConfig.certifications && siteConfig.certifications.length > 0;
---
<footer class="relative bg-gray-50 border-t border-gray-200">
  <div class="mx-auto max-w-6xl px-6 py-12 lg:px-8">
    <div class="flex flex-row items-center justify-between gap-6 w-full">

      <!-- LEFT: Name + Title -->
      <div class="flex flex-col gap-1">
        <h3
          class="footer-name text-2xl font-bold relative inline-block footer-brand"
          style={`--accent-color:${siteConfig.accentColor}; color: var(--accent-color);`}
        >
          <span class="name-front">dearlipu</span>
          <span class="name-back">Saurav Panda</span>
        </h3>

        <p class="text-base text-gray-500">
          {siteConfig.title}
        </p>
      </div>

      <!-- RIGHT SIDE -->
      <div class="flex items-start gap-6">
        <!-- Mobile Resume Button ONLY -->
        <div class="block md:hidden">
          <a href="/saurav_panda_resume.pdf" download class="resume-pill">
            Resume
          </a>
        </div>

        <!-- Desktop Right Area -->
        <div class="hidden md:flex flex-col md:items-end gap-1">
          <!-- Contact pill uses server-side MAILTO -->
          <a
            href={MAILTO}
            id="footerMailLink"
            data-email={EMAIL}
            data-mailto={MAILTO}
            class="contact-pill"
            aria-label="Contact Me"
          >
            Contact Me
          </a>

          <!-- Fallback (hidden by default) -->
          <div id="footerMailFallback" class="hidden mt-2 inline-flex items-center gap-3 bg-white border border-gray-200 rounded-full px-3 py-2 shadow-sm" aria-hidden="true">
            <span class="text-sm text-gray-700">Email:</span>
            <span id="footerMailText" class="font-medium text-sm select-all">{EMAIL}</span>
            <button id="footerCopyBtn" class="ml-2 px-2 py-1 rounded-full bg-gray-100 text-sm">Copy</button>
            <button id="footerFallbackClose" class="ml-2 text-sm text-gray-500">Close</button>
          </div>

          <p class="text-sm text-gray-500">
            © {new Date().getFullYear()} dearlipu • All rights reserved.
          </p>
        </div>
      </div>

    </div>
  </div>

  <!-- Decorative pattern -->
  <div class="absolute inset-0 -z-10 overflow-hidden">
    <svg aria-hidden="true" class="absolute bottom-0 left-0 w-full h-24 text-gray-100">
      <pattern id="footer-pattern" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse">
        <path d="M0 50 Q 25 40, 50 50 T 100 50"
              stroke="currentColor" stroke-width="0.5" fill="none" opacity="0.4"></path>
      </pattern>
      <rect width="100%" height="100%" fill="url(#footer-pattern)"></rect>
    </svg>
  </div>

<style>
  .footer-name { cursor: pointer; }
  .footer-name .name-front, .footer-name .name-back { display: block; transition: opacity .25s, transform .25s; }
  .name-back { opacity:0; transform: translateY(6px); position:absolute; left:0; top:0; }
  .footer-name:hover .name-front { opacity:0; transform: translateY(-6px); }
  .footer-name:hover .name-back { opacity:1; transform: translateY(0); }
  .footer-brand { font-family: "Ubuntu", sans-serif; font-weight:700; }

  .contact-pill { display:inline-flex; align-items:center; justify-content:center; padding:0.45rem 1.4rem; background:#f3f4f6; color:#1f2937; font-size:1rem; font-weight:600; border-radius:999px; transition:all .2s; box-shadow:0 2px 6px rgba(0,0,0,.06); }
  .contact-pill:hover { background:#e5e7eb; transform:translateY(-1px); }

  .resume-pill { display:inline-flex; align-items:center; justify-content:center; padding:.55rem 1.4rem; background:#f3f4f6; color:#1f2937; font-size:1rem; font-weight:600; border-radius:999px; box-shadow:0 6px 18px rgba(15,23,42,.06); }
  .resume-pill:hover { background:#e9e9ea; transform:translateY(-2px); }

  /* fallback visibility helpers */
  #footerMailFallback.hidden { display:none !important; opacity:0; pointer-events:none; }
  #footerMailFallback.visible { display:inline-flex !important; opacity:1; pointer-events:auto; transition:opacity .18s ease; }

  /* small layout tweak */
  @media (min-width: 1024px) { .mx-auto.max-w-6xl { max-width:72rem; } }
  #footerMailFallback .select-all { user-select:all; }
</style>

<script>
  (function () {
    const link = document.getElementById("footerMailLink");
    const fallback = document.getElementById("footerMailFallback");
    const copyBtn = document.getElementById("footerCopyBtn");
    const closeBtn = document.getElementById("footerFallbackClose");
    const mailText = document.getElementById("footerMailText");

    if (!link || !fallback) return;

    const to = link.dataset.email || mailText.textContent || "";
    const mailto = link.dataset.mailto || link.getAttribute("href") || `mailto:${to}`;

    const isMobile = () => /Mobi|Android|iPhone|iPad|Phone/i.test(navigator.userAgent);

    let hideTimeout = null;

    function showFallback() {
      clearTimeout(hideTimeout);
      fallback.classList.remove("hidden");
      fallback.classList.add("visible");
      fallback.setAttribute("aria-hidden", "false");
      hideTimeout = setTimeout(hideFallback, 8000);
    }

    function hideFallback() {
      clearTimeout(hideTimeout);
      fallback.classList.remove("visible");
      fallback.classList.add("hidden");
      fallback.setAttribute("aria-hidden", "true");
    }

    function tryMailtoOrFallback() {
      // attempt to open mail client
      window.location.href = mailto;

      // if page remains visible after short delay, show fallback
      setTimeout(() => {
        if (document.visibilityState === "visible") {
          showFallback();
        }
      }, 700);
    }

    link.addEventListener("click", function (e) {
      if (isMobile()) {
        // mobile: let native mail app handle mailto
        return;
      }
      e.preventDefault();
      tryMailtoOrFallback();
    });

    copyBtn?.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(to);
        copyBtn.textContent = "Copied";
        setTimeout(() => (copyBtn.textContent = "Copy"), 1600);
        hideFallback();
      } catch (err) {
        copyBtn.textContent = "Copy failed";
        setTimeout(() => (copyBtn.textContent = "Copy"), 1600);
      }
    });

    closeBtn?.addEventListener("click", () => hideFallback());

    // hide if user clicks outside fallback
    document.addEventListener("click", (ev) => {
      if (fallback.classList.contains("hidden")) return;
      if (!fallback.contains(ev.target) && !link.contains(ev.target)) hideFallback();
    }, true);
  })();
</script>
</footer>
